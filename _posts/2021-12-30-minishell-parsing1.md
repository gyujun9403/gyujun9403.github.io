---
layout: post
title: "Minishell Parsing01"
description: "42서울 과제 Minishell의 파싱부 조건 정리 입니다."
date: 2021-12-28
tags: [42Seoul, minishell]
comments: true
share: true
---
# MiniShell 과제 파싱부 구상...
## 1. 개요

Minishell에서 가장 복잡하고 변수가 많은 부분은 파싱부라고 해도 과언은 아니다. 해당 부분을 구현함에 있어서 마구잡이로 코드를 작성하기보다는, 정리하고 거기에 맞춰서 코드를 쓰는게 더 빠르고 정확한 길이라 판단되어 해당 글을 작성한다.

## 2. Parsing 진리표

| 문자 \ flag | ' Flg | " Flg | $ Flg | Flg 없음 |
| ---- | ---- | ----| ---- | ---- |
| white | 무시 | 무시 | 환경변수대체, 바로뒤면그냥$ | 다음줄 |

- 다음줄 : char**에서 다음 줄을 추가하고 cursor가 이를 가르키게
- 무시 : 해당 문자를 텍스트 그대로 인식한다.
- cat : cursor가 가르키는 문자열에 지금까지의 문자열 cat
- 중첩 : flg가 중복되는 경우는 "FlgON된 상태에서 &가 입력되는 상태 뿐이다.
- 환경변수대체 : 환경변수 이름으로 인식하고 있던 문자열을 검색해서 해당하는 문자를 cursor가 가르키는 부분에 cat한다.
- FlgON / FlgOFF : 해당 문자에 대응되는 Flg를 ON/OFF한다.
- 다음리스트 : |의 경우 다름 리스트로 이동하고, cursor가 이를 가르키게 한다.
$는 cat할때 해당 환경변수가 가지고 있는 값으로 변환되어 cmds에 저장되게한다.

그렇다면... 이제 위의 조건들을 어떻게 코드로 구현하느냐

## 3. 동작방식 및 수도코드
- ast에서 cursor가 지목하는 문자열에 cat하는 방식으로 구현.
- cursor의 위치는 문자열의 시작주소만을 가르키며, flg없이 whitespace가 오는 경우 다음(줄)로 넘어간다.
- 화이트 스페이스가 있으면 전부 넘긴 후, 커서를 다음줄로 옮긴다.
- idx위치에서 slide(오프셋)을 증가시키면서 한번에 cat하여 malloc 및 free의 빈도를 줄인다.
- cat 할때는 단순히 cursor에만 cat하면 해결되게 코드를 작성한다.
- result를 받고서 해야하는 동작은 다음과 같다.
	1. 다음 문자로 넘어가기(경우에 따라 1~2칸) -> ~하는 경우
	2. idx부터 idx+slide까지를 커서에 cat한다. 이때 $가 ON인상태에서는 환경변수에서 찾아서 cat.
	3. 한글자 넘기고 다음 리스트로 간다(명령어 or 파일로 세팅)

```c
while(문자열이 끝날때까지)
{
	// 공백문자 날리기
	if (공백문자 && 코트플래그OFF)
		while(공백문자)
			++idx; ->  공백문자 넘기기
	// 다음에 오는 문자를 보고 어떻게 행동할지 + 플래그 재설정
	result = chk(문자열[idx + slide], 플래그);
	
	if (result == 넘어가기)
		++slide;
	if ()
}
```

